---
title: 必须搞懂的跨域解决方案
date: 2021-8-16
author: Justin
top: false
cover: false
categories: 面试题
tags:
  - 面试题
---
## 跨域是什么？
>关于跨域是什么，我们这里先不做介绍，我们先介绍下跨域的前置知识（同源策略）。同源策略是浏览器的重要安全策略。同源策略指的是浏览器只有在两个页面拥有相同源的时候，才允许第一个页面中的脚本访问第二个页面中的数据。这里的同源指的是协议、域名、端口号三者同源。

## 跨域请求有没有发送到服务器端？
>跨域请求实际上已经发送到了服务器，并且客户端也接收到了返回的消息，然而浏览器在接收消息后发现这个信息违反了同源策略且没有被允许跨域，所以在解析该消息的时候会报错。

## 同源策略限制哪些，不限制哪些？
**限制以下内容：**
* Ajax请求。
* Cookie、LoaclStorage。
* DOM对象。

**不限制以下内容：**
![image.png](https://img-blog.csdnimg.cn/img_convert/6e29f60caeb869a2db81bc965be6d420.png)

## 跨域解决方案
### 方案一：JSONP
>核心思路：利用html中的script标签不受同源策略的限制来进行跨域，在客户端脚本中定义好处理的函数，然后通过请求参数传递给服务器端，服务器端进行字符串拼接后返回调用该函数。
* 客户端
![image.png](https://img-blog.csdnimg.cn/img_convert/a1ef438c1dc47f83db7ffcdd5d2445a1.png)
* 服务器端（express）
![image.png](https://img-blog.csdnimg.cn/img_convert/d1c4b1af0008dc60e90127b0a5df2348.png)

[CodeSandBox在线演示](https://codesandbox.io/s/optimistic-murdock-ie1dc?file=/package.json)

**优缺点**
* 优点：简单方便。
* 缺点：仅支持get方法，且需要服务器端进行协同。
### 方案二：CORS
>CORS（跨域资源共享）会通过HTTP头的形式告诉浏览器哪些不同来源的客户端可以访问本站的资源的。实现CORS跨域的关键在服务端，只要服务端设置了Access-Control-Allow-Origin就可以开启CORS，该属性可以设置哪些域名可以访问服务器，如果设置为星号则表示所有资源都可以访问服务器资源。CORS进行跨域的时候会将请求分为简单请求和预检请求，简单请求。
### 1. 简单请求(可以直接发出)
>请求方法为以下类型：
* GET
* POST
* HEAD

### 2. 预检请求
>预检请求必须先向服务器发送初步预检请求以获得许可，然后才可以继续发送主请求。下面介绍下需要进行预检的请求。
* 请求的不是GET/HEAD/POST方法.
* 请求使用POST方法且Content-Type不是text/plain、application/x-www-form-urlencoded或multipart/form-data.
* 请求设置了自定义标头，如X-PINGOTHER.

**CORS跨域实例**

* 客户端
![image.png](https://img-blog.csdnimg.cn/img_convert/e4f295e8d0f72e10705170ee120be243.png)

* 服务器端
![image.png](https://img-blog.csdnimg.cn/img_convert/d19ec8ce1259f51ec37d038cb8dc9169.png)